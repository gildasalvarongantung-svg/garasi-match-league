<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Garasi Match League</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
background:#0f172a;
color:white;
font-family:Arial;
text-align:center;
}

.container{
max-width:900px;
margin:auto;
}

.match{
background:#1e293b;
padding:15px;
margin:12px;
border-radius:10px;
}

.players{
display:flex;
justify-content:space-between;
align-items:center;
}

.score{
font-size:28px;
}
button{
padding:5px 10px;
margin:5px;
font-size:18px;
cursor:pointer;
}
</style>
</head>

<body>

<h1>GARASI MATCH LEAGUE</h1>
<div class="container" id="matches"></div>

<script>

const client = supabase.createClient(
"https://rrjxsdxaholwhdzidpvx.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyanhzZHhhaG9sd2hkemlkcHZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MzcwNTcsImV4cCI6MjA4NzQxMzA1N30.VIcs9IqSpZUAw43gYYQ4RWWb29dBIk422BuQzWeyA6k"
)

async function loadMatches(){
const { data } = await client
.from("matches")
.select("*")
.order("table_number")

const container = document.getElementById("matches")
container.innerHTML=""

if(!data) return

data.forEach(match=>{
const div=document.createElement("div")
div.className="match"

div.innerHTML=`
<h3>Table ${match.table_number}</h3>

<div class="players">

<div>
${match.player1}
<br>
<button onclick="changeScore(${match.id},1,-1)">-</button>
<span class="score">${match.score1}</span>
<button onclick="changeScore(${match.id},1,1)">+</button>
</div>

<div>VS</div>

<div>
${match.player2}
<br>
<button onclick="changeScore(${match.id},2,-1)">-</button>
<span class="score">${match.score2}</span>
<button onclick="changeScore(${match.id},2,1)">+</button>
</div>

</div>
`

container.appendChild(div)
})
}

async function changeScore(id,player,amount){

const { data } = await client
.from("matches")
.select("*")
.eq("id",id)
.single()

let s1=data.score1
let s2=data.score2

if(player===1) s1+=amount
if(player===2) s2+=amount

if(s1<0) s1=0
if(s2<0) s2=0

await client
.from("matches")
.update({
score1:s1,
score2:s2
})
.eq("id",id)

loadMatches()
}

loadMatches()

</script>

</body>
</html>