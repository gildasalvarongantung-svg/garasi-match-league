<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Garasi Match League</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  font-family: Arial;
  background:#0f172a;
  color:white;
  text-align:center;
}

.container{
  max-width:900px;
  margin:auto;
}

.match{
  background:#1e293b;
  padding:15px;
  margin:10px;
  border-radius:10px;
}

.players{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.score{
  font-size:28px;
}

button{
  padding:5px 10px;
  margin:5px;
  font-size:18px;
  cursor:pointer;
}
</style>
</head>

<body>

<h1>GARASI MATCH LEAGUE</h1>

<div class="container" id="matches"></div>

<script>

const supabase = window.supabase.createClient(
"https://rrjxsdxaholwhdzidpvx.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJyanhzZHhhaG9sd2hkemlkcHZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4MzcwNTcsImV4cCI6MjA4NzQxMzA1N30.VIcs9IqSpZUAw43gYYQ4RWWb29dBIk422BuQzWeyA6k"
)

async function loadMatches(){
const { data } = await supabase
.from("matches")
.select("*")
.order("id")

const container = document.getElementById("matches")
container.innerHTML=""

data.forEach(match=>{
const div=document.createElement("div")
div.className="match"

div.innerHTML=`
<h3>Table ${match.table_number}</h3>

<div class="players">

<div>
${match.player1}
<br>
<button onclick="changeScore(${match.id},1,-1)">-</button>
<span class="score">${match.score1}</span>
<button onclick="changeScore(${match.id},1,1)">+</button>
</div>

<div>VS</div>

<div>
${match.player2}
<br>
<button onclick="changeScore(${match.id},2,-1)">-</button>
<span class="score">${match.score2}</span>
<button onclick="changeScore(${match.id},2,1)">+</button>
</div>

</div>
`

container.appendChild(div)
})
}

async function changeScore(id,player,amount){

const { data } = await supabase
.from("matches")
.select("*")
.eq("id",id)
.single()

let newScore1=data.score1
let newScore2=data.score2

if(player===1) newScore1+=amount
if(player===2) newScore2+=amount

if(newScore1<0) newScore1=0
if(newScore2<0) newScore2=0

await supabase
.from("matches")
.update({
score1:newScore1,
score2:newScore2
})
.eq("id",id)

loadMatches()
}

loadMatches()

supabase
.channel("realtime")
.on(
"postgres_changes",
{event:"*",schema:"public",table:"matches"},
()=>loadMatches()
)
.subscribe()

</script>

</body>
</html>